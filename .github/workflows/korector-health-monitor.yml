name: Korector Health Monitor

on:
  schedule:
    - cron: '0 0 * * *'  # 매일 자정 (UTC 기준, 필요시 조정)
  workflow_dispatch:

permissions:
  contents: read
  # Issue 자동 생성까지는 당분간 하지 말고, 나중에 안정되면 추가하는 걸 추천

jobs:
  health-check:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install build tools
      run: |
        pip install --upgrade pip
        pip install build setuptools wheel

    - name: Build package
      run: |
        python -m build

    - name: Install Korector (local build)
      run: |
        pip install .

    - name: Run Korector health check
      run: |
        python - << 'EOF'
        from korector import NaverSpellChecker
        import json

        print("=== Korector Health Check ===")
        try:
            import korector
            print("Version:", getattr(korector, "__version__", "unknown"))
        except Exception as e:
            print("Version: unknown (import error)", e)

        checker = NaverSpellChecker(verbose=False)
        result = checker.health_check()

        print(json.dumps(result, ensure_ascii=False, indent=2))

        if result.get("status") != "ok":
            raise SystemExit(1)
        EOF
